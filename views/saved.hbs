<h2>Your Saved Trips</h2>

{{#if trips.length}}
  <div class="trip-list">
    {{#each trips}}
      <a name="trip-{{@index}}"></a>
      <div class="trip-card">
        <div class="trip-header">
          <h3>
            {{trip_name}} {{getTripIcon trip_type}}
          </h3>
          <a href="/trip/{{trip_name}}" class="view-trip-link">View Trip</a>
        </div>
        <span class="trip-dates">
          {{formatDate start_date}} - {{formatDate end_date}}
        </span>

        <p class="trip-destination">{{destination}}</p>

        <p><strong>Travelers:</strong> {{travelers}}</p>

        <div class="trip-details">
          <div class="trip-detail-row">
            <p><strong>Transport:</strong> {{transport}}</p>
            <p><strong>Transport Budget:</strong> ${{transport_budget}}</p>
          </div>
          <div class="trip-detail-row">
            <p><strong>Lodging:</strong> {{lodging}}</p>
            <p><strong>Lodging Budget:</strong> ${{lodging_budget}}</p>
          </div>
        </div>
        <p class="trip-total"><strong>Total Estimated Budget:</strong> ${{add transport_budget lodging_budget}}</p>
        <div class="savings-section">
          <p>
            <strong>Savings Goal:</strong> ${{savings_goal}} |
            <strong>Saved:</strong> ${{savings_saved}} |
            <strong>Progress:</strong> {{savings_percent}}%
          </p>

          <div class="progress-bar">
            <div class="progress-fill" style="width: {{savings_percent}}%;"></div>
          </div>
          
          <form method="POST" action="/savings/add" class="savings-form">
            <input type="hidden" name="trip_id" value="{{trip_name}}" />
            <input type="hidden" name="index" value="{{@index}}" /> <!-- ADD THIS -->
            <label for="amount-{{@index}}">Add to Savings:</label>
            <input type="number" name="amount" id="amount-{{@index}}" step="0.01" min="0.01" required />
            <button class="cute-button" type="submit">ðŸ’¾ Save</button>
          </form>
          {{#if (gte savings_saved savings_goal)}}
            <div class="goal-message" id="goal-message-{{@index}}">
              {{#if (eq savings_saved savings_goal)}}
                ðŸŽ‰ You've reached your goal!
              {{else}}
                ðŸŽ‰ You've reached your goal (and a little more too)! ðŸ˜‰
              {{/if}}
              <canvas id="confetti-{{@index}}" class="confetti-canvas"></canvas>
            </div>
          {{/if}}
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <p>You have no saved trips yet. Start one from the homepage!</p>
{{/if}}

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.goal-message').forEach((el, index) => {
      const canvas = document.getElementById(`confetti-${index}`);
      if (canvas) {
        const confetti = window.confetti.create(canvas, {
          resize: true,
          useWorker: true
        });
        confetti({
          particleCount: 80,
          spread: 60,
          origin: { y: 0.6 }
        });
      }
    });
  });
</script>
